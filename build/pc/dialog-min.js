/**
 * @file dialog plugin
 * @author xucaiyu
 * @email 569455187@qq.com
 * @version 1.0.0
 * @date 2014-10-15
 * @license MIT License 
 */
!function(){function t(t){var a,o=this;a=$.extend(!0,{},c,t);var r=a.drag;if(o.css=a.css,o.options=a,o.type=a.type,o.$parent="string"==typeof a.container?$(a.container):a.container,o.$el=$(e),o.$el.addClass(a.className),o._isBody="BODY"==this.$parent[0].nodeName,(a.fixed&&!o._isBody||"msg"==o.type)&&(o.options.isMove=!1),o._cid=n++,o._zIndex=i++,o.$elArr=[],a.beforeFn.apply(this),o.init(r),a.afterFn.apply(this),o.$iframe){var s=o.$iframe[0];s.attachEvent?s.attachEvent("onload",function(){a.onloadFn&&a.onloadFn(),s.detachEvent("onload",arguments.caller)}):s.onload=function(){a.onloadFn&&a.onloadFn(),s.onload=null}}t=null}var e,n=1,i=99999900,a=[],o=!-[1],r=o&&!window.XMLHttpRequest,s=$(document),l=$(window),c={className:"",container:"body",css:{padding:"10px"},html:"加载中...",value:"",title:"信息",left:"50%",top:"50%",src:"about:blank",scrolling:"auto",align:"center",animate:!1,animateAlign:"bottom",winBtn:!0,buttons:[{name:"确定",callback:function(){},disabled:!1,focus:!1},{name:"取消",callback:function(){},disabled:!1,focus:!1}],closeBtn:function(){},beforeFn:function(){},onloadFn:function(){},afterFn:function(){},shade:!0,shadeClose:!1,unload:!0,delay:!1,opacity:.3,fixed:!1,isMove:!0,resize:!0,drag:{limit:!0,range:[0,9999,9999,0],lockX:!1,lockY:!1,onStart:function(){},onMove:function(){},onEnd:function(){}}};e='<table class="xcy-table xcy-warpper"><tbody><tr><td class="xcy-tl"></td><td class="xcy-tc"></td><td class="xcy-tr"></td></tr><tr><td class="xcy-cl"></td><td class="xcy-cc"><div class="xcy-layer"></div></td><td class="xcy-cr"></td></tr><tr><td class="xcy-bl"></td><td class="xcy-bc"></td><td class="xcy-br"></td></tr></tbody></table>';var d={sort:function(t){var e,n,i,o=a.length;for(e=0;o>e;e++)if(a[e]._cid==t){if(e==o-1){if(!n)return;return void $.each(a,function(t,e){e.$el.css("zIndex",e._zIndex)})}n=a[e],i=a[e+1]._zIndex,a[e]=a[e+1],a[e+1]=n,a[e]._zIndex=a[e+1]._zIndex,a[e+1]._zIndex=i}},toNumber:function(t,e){if(!t&&0!==t||"number"==typeof t)return t;var n=t.length-1;return t.lastIndexOf("px")===n-1?t=parseInt(t):t.lastIndexOf("%")===n&&(e||(e=100),t=parseInt(e*t.split("%")[0]/100)),t},debounce:function(t,e,n){if("function"==typeof t){e=e||150,n=n||null;var i,a=function(){t.apply(n)};return function(){window.clearTimeout(i),i=window.setTimeout(a,e)}}}};t.prototype={v:"2.0.1",constructor:t,init:function(t){var e,n=this,i=n.options,a=i.title,o=i.html,s="shade"==n.type||i.shade,c=n.$el,u=i.resize;switch(s&&(e="#shade-layer-"+n._cid,n.$elArr.push(e),n._shadeHtml(e),i.shadeClose&&n._bindShadeClose()),n.type){case"load":e="#load-layer-"+n._cid,n._layerHtml(!1,o,!1);break;case"confirm":e="#confirm-layer-"+n._cid,n._layerHtml(a,o,i.buttons);break;case"prompt":e="#prompt-layer-"+n._cid,n._layerHtml(a,o,i.buttons);break;case"alert":e="#alert-layer-"+n._cid,n._layerHtml(a,o,i.buttons);break;case"msg":e="#msg-layer-"+n._cid,n._layerHtml(a,o,!1);break;case"iframe":e="#iframe-layer-"+n._cid,n._layerHtml(a,!0,!1);break;default:e="#page-layer-"+n._cid,n._layerHtml(a,o,!1)}if(n.$elArr.push(e),c.attr("id",e.substring(1)),i.fixed&&(n._isBody?r?(n._ie6Fix=n._topFixed(l),l.bind("scroll",n._ie6Fix)):n.$el.addClass("xcy-fixed"):(n._ie6Fix=n._topFixed(n.$parent),n.$parent.bind("scroll",n._ie6Fix))),r&&n._ie6SelectFix(),!u||!i.fixed&&i.isMove||(n._winResize=function(){i.isMove&&n._dragObj._size();var t=n.parentHeight-n.warpperHeight,e=n.parentWidth-n.warpperWidth,a=Number(n.top)/t,o=Number(n.left)/e;d.debounce(function(){n._getParentSize();var t=n.parentHeight-n.warpperHeight,e=n.parentWidth-n.warpperWidth,i=Math.round(a*t),r=Math.round(o*e);n.$el.css(n._setCss(i,r)),s&&n._shadeCss($(n.$elArr[0]))})()},l.bind("resize",n._winResize)),i.isMove){t.selector=e,t.container=i.container,t.fixed=i.fixed,t.target=".xcy-title",t.isBody=n._isBody;var h=t.onMove;t.onMove=function(t,e){n.top=t,n.left=e,h(t,e)},n._dragObj=new p(t)}i.delay&&(n.timer=setTimeout(function(){n._autoClose()},"boolean"==typeof i.delay?1800:i.delay))},_autoClose:function(){var t=this,e=t.$elArr.length-1;t.closed=!0,$.each(t.$elArr,function(n,i){$(i).animate({opacity:"0"},800,function(){n==e&&t.close()})})},_bindShadeClose:function(){var t=this,e=$(".xcy-shade",t.$parent);e&&e.bind("click",function(){t.closed||t.close()})},_getContent:function(){return $(".xcy-content",this.$el)},_getTitle:function(){return $(".xcy-title",this.$el)},_getFoot:function(){return $(".xcy-foot",this.$el)},_layerHtml:function(t,e,n){var i,a,o,r,s=this,l=s.options,c=s.type,p=s.$el,u=s.css,h=t!==!1;if(l.title=t,s._getParentSize(),h&&(i=s._titHtml(t),$(".xcy-layer",p).append(i)),"load"==c?a=s._loadHtml(e):"iframe"==c?a=s._iframeHtml(l.src):("prompt"==c?(a=s._conHtml('<div class="xcy-text"></div><input class="xcy-input" type="text" value="'+l.value+'" />'),a.find(".xcy-text").html(e)):a=s._conHtml(e),$(".xcy-main",a).css(u)),$(".xcy-layer",p).append(a),s.$parent.append(p),n&&(o=s._btnHtml(n),$(".xcy-layer",p).append(o)),"load"!==c&&l.closeBtn&&(r=s._winBtnHtml(c),$(".xcy-layer",p).append(r)),s._setConCss(s._getContent(),l.width,l.height),s._getWarpperSize(p),l.animate){var f={};"bottom"==l.animateAlign?f={top:s.parentHeight+s.warpperHeight,left:d.toNumber(l.left,s.parentWidth-s.warpperWidth)}:"top"==l.animateAlign?f={top:-s.parentHeight,left:d.toNumber(l.left,s.parentWidth-s.warpperWidth)}:"left"==l.animateAlign?f={top:d.toNumber(l.top,s.parentHeight-s.warpperHeight),left:-s.warpperWidth}:"right"==l.animateAlign&&(f={top:d.toNumber(l.top,s.parentHeight-s.warpperHeight),left:s.parentWidth+s.warpperWidth}),p.css(f),p.animate(s._setCss(l.top,l.left),1200)}else p.css(s._setCss(l.top,l.left),l.delay);try{n&&s.$focus.focus()}catch(m){}},_shadeHtml:function(t){var e=this,n=$('<div class="xcy-shade" id="'+t.substring(1)+'"></div>');e._shadeCss(n),e.$parent.append(n)},_shadeCss:function(t){var e=this,n=e.options.opacity,i=e._isBody,a=i?$("body").outerWidth():e.$parent[0].scrollWidth,o=i?s.innerHeight():e.$parent[0].scrollHeight;t.css({width:a,height:o,opacity:n,"z-index":e._zIndex})},_loadHtml:function(t){var e=this,n=e.options,i=$('<div class="xcy-load"><span class="xcy-load-img"></span><span>'+t+"</span></div>");return e._setConCss(i,n.width,n.height),i},_iframeHtml:function(t){var e=this,n=e.options,i=$('<iframe allowtransparency="true" frameborder="0" class="xcy-iframe" name="xcy-iframe'+e._cid+'"  src="'+t+'" scrolling="'+n.scrolling+'"></iframe>');return e.$iframe=i,e._conHtml("").html(i)},_conHtml:function(t){var e,n,i,a,o=this,r=(o.options,$('<div class="xcy-content"><div class="xcy-main"></div></div>'));return t&&1===t.nodeType&&(e=t.style.display,n=t.previousSibling,i=t.nextSibling,a=t.parentNode,o._elemBack=function(){n&&n.parentNode?n.parentNode.insertBefore(t,n.nextSibling):i&&i.parentNode?i.parentNode.insertBefore(t,i):a&&a.appendChild(t),t.style.display=e,o._elemBack=null}),r.find(".xcy-main").html(t),r},_titHtml:function(t){var e=$('<div class="xcy-title"></div>');return e.append("<span>"+t+"</span>"),e},_btnHtml:function(t){var e=this,n=$('<div class="xcy-foot"></div>'),i="",a=t.length-1;return $.each(t,function(t,e){var n=e.disabled?"disabled":"",o="";o=0===t?"xcy-btn-r":t==a?"xcy-btn-l":"xcy-btn-m",i+='<button class="xcy-btn '+o+'" type="button" '+n+">"+e.name+"</button>"}),n.html(i),n.css("text-align",e.options.align),$("button",n).each(function(n){var i,a,o,r=$(this),s=t[n];r.click(function(){a=s.callback,o=$(".xcy-input",e._getContent()).val(),a&&(i=a(r.text(),o)),i!==!1&&e.close()}),s.focus&&!s.disabled&&(e.$focus=r)}),n},_winBtnHtml:function(t){var e=this,n=e.options,i=n.closeBtn,a=n.winBtn,o=$('<div class="xcy-winBtn"></div>'),r=!0,s="xcy-close-btn";return"iframe"==t&&a&&(o.append('<a class="xcy-winBtn-btn" id="xcy-min-btn" href="javascript:;">-</a>'),o.append('<a class="xcy-winBtn-btn" id="xcy-full-btn" href="javascript:;">+</a>')),("msg"==t&&e.options.title===!1||"page"==t&&e.options.title===!1)&&(s="xcy-x-btn"),o.append('<a class="xcy-winBtn-btn"  id="'+s+'" href="javascript:;">×</a>'),$("a",o).bind("click",function(){var t=$(this).attr("id"),n=!0;switch(t){case"xcy-close-btn":case"xcy-x-btn":if(i&&(n=i(e.title())),n===!1)return;e.close();break;case"xcy-full-btn":r?(e.full(),r=!1):($("#xcy-min-btn",e.$el).show(),e.restore(),r=!0);break;case"xcy-min-btn":$(this).hide(),e.min(),r=!1}}),o},_topFixed:function(t){var e,n=this;return e=function(){d.debounce(function(){n.$el.css({top:n.top+t.scrollTop(),left:n.left+t.scrollLeft()})})()}},_ie6SelectFix:function(){var t,e=this,n=e.$el,i=e.warpperWidth,a=e.warpperHeight;t=document.createElement("iframe"),t.src="about:blank;",t.style.cssText="position:absolute;z-index:-1;left:0;top:0;filter:alpha(opacity=0);border:0 none;width:"+i+"px;height:"+a+"px;",n.append(t)},_toNumberW:function(t){var e,n,i=this;i._getWarpperSize(i.$el),i._getConWidth(),t&&(-1!==String(t).indexOf("%")&&(e=i.width,n=i.warpperWidth-e,t=d.toNumber(t,i.parentWidth-n)),i.width=t)},_toNumberH:function(t){var e,n,i=this;i._getWarpperSize(i.$el),i._getConHeight(),t&&(-1!==String(t).indexOf("%")&&(e=i.height,n=i.warpperHeight-e,t=d.toNumber(t,i.parentHeight-n)),i.height=t)},_setConCss:function(t,e,n){{var i=this;i.css}i._toNumberW(e),t.css({width:i.width}),i._toNumberH(n),t.css({height:i.height})},_setCss:function(t,e){var n=this,i=n.options,a=(n.$parent,n._isBody),o=0,l=0,c={};return i.fixed&&r&&(o=a?s.scrollTop():n.$parent.scrollTop(),l=a?s.scrollLeft():n.$parent.scrollLeft()),(void 0===t||""==t)&&(t="50%"),t=d.toNumber(t,n.parentHeight-n.warpperHeight),n.top=t,(void 0===e||""==e)&&(e="50%"),e=d.toNumber(e,n.parentWidth-n.warpperWidth),n.left=e,c["z-index"]=n._zIndex,c.top=t+o,c.left=e+l,c},_getConWidth:function(){var t=this;t.width=t._getContent().outerWidth()},_getConHeight:function(){var t=this;t.height=t._getContent().outerHeight()},_getParentSize:function(){var t=this,e=(t.options,t.$parent),n=t._isBody;t.parentWidth=n?l.innerWidth():e[0].clientWidth,t.parentHeight=n?l.innerHeight():e[0].clientHeight},_getWarpperSize:function(t){this.warpperWidth=t.outerWidth(),this.warpperHeight=t.outerHeight()},min:function(){this.resize("180","0",0,180*(a.length-1))},full:function(){this.resize("100%","100%",0,0)},restore:function(){var t=this,e=t._restore;t.resize(e.width,e.height,e.top,e.left)},title:function(t){var e=this._getTitle().children("span"),n=t?e.html(t):e.html();return t?this:n},html:function(t){return this._getContent().html(t),this},buttons:function(t){return $("button",this.$el).unbind("click"),this._getFoot().replaceWith(this._btnHtml(t)),this},resize:function(t,e,n,i){var a,o,r,s,l,c,d=this,p=parseInt(d.$el.css("left")),u=parseInt(d.$el.css("top"));return d._restore={top:d.top,left:d.left,height:d.height,width:d.width},d._toNumberW(t),d._toNumberH(e),a=d.width,o=d.height,this.options.height=e,this.options.width=t,s=(a-t)/2,r=(o-e)/2,l=void 0!==i?i:p+s,c=void 0!==n?n:u+r,d._setConCss(d._getContent(),t,e),d._getWarpperSize(d.$el),this._dragObj?d._dragObj._move(c,l,d.warpperHeight,d.warpperWidth):d.$el.css(d._setCss(n,i)),this},moveTo:function(t,e){var n=this;return t=d.toNumber(t,n.parentHeight),e=d.toNumber(e,n.parentWidth),box=this._dragObj?n._dragObj.range(t,e,n.warpperWidth,n.warpperHeight):n.$el.css(n._setCss(t,e)),n.$el.css(n._setCss(box.top,box.left)),this},setDrag:function(t){return this._dragObj?(this._dragObj.set(t),this):this},hide:function(){return $.each(this.$elArr,function(t,e){$(e).hide()}),this},show:function(){return $.each(this.$elArr,function(t,e){$(e).show()}),this},close:function(){var t=this;return t.timer&&(clearTimeout(t.timer),t.timer=null),t.closed=null,t.options.unload?void t.unload():void t.hide()},unload:function(){var t,e=this;if($("button",e.$el).unbind("click"),$(".xcy-winBtn a",e.$el).unbind("click"),e._winResize&&l.unbind("resize",e._winResize),e._ie6Fix&&(l.unbind("scroll",e._ie6Fix),e.$parent.unbind("scroll",e._ie6Fix)),e.options.shadeClose&&$(".xcy-shade",e.$parent).unbind("click"),e.options.isMove&&e._dragObj.disable(),e._elemBack&&e._elemBack(),"iframe"===e.type)try{var n=e.$iframe[0];n.contentWindow.document.write(""),n.contentWindow.close(),e.$iframe.remove()}catch(i){}for($.each(e.$elArr,function(t,e){$(e).remove()}),e.$elArr=null,t=a.length;t--;)a[t]._cid===this._cid&&a.splice(t,1)},closeAll:function(){$.each(a,function(t,e){e.close()})}};var p=function(){function t(t){function e(t){var e,i=t.type,a=$(t.target);switch(e=0!==a.parents(n.target).length?a.parents(n.target):a,i){case"mousedown":d.sort(n.options.selector.split("-")[2]),"true"==e.attr("data-move")&&(n.diffx=t.clientX-n.$parent[0].offsetLeft,n.diffy=t.clientY-n.$parent[0].offsetTop,n._getOffSize(),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),o?(n.$parent.bind("losecapture",n._end),n.$parent[0].setCapture()):s.bind("blur",n._end),s.bind("mousemove",n._handleEvent),s.bind("mouseup",n._handleEvent),n.options.onStart(),t.preventDefault());break;case"mousemove":var r=t.clientX-n.diffx,l=t.clientY-n.diffy;n._move(l,r,n.offH,n.offW),t.preventDefault();break;case"mouseup":n._end()}}var n=this;n.diffx=0,n.diffy=0,n.options=t,n.$parent=$(n.options.selector),n.target=t.target,n._handleEvent=e,n._init()}return t.prototype={_init:function(){var t=this,e=$(t.target,t.$parent);t._size(),e.attr("data-move","true"),e.css("cursor","move"),t.$parent.bind("mousedown",t._handleEvent)},_getActive:function(){try{var t=document.activeElement,e=t.contentDocument,n=e&&e.activeElement||t;return n}catch(i){}},_size:function(){var t,e=this,n=e.options,i=n.range;n.limit&&(e.mxT=i[0],e.mxR=void 0!==i[1]?i[1]:i[0],e.mxB=void 0!==i[2]?i[2]:i[0],e.mxL=void 0!==i[3]?i[3]:i[1]?i[1]:i[0],e._getOffSize(),t=$(n.container),!n.fixed&&n.isBody?(e.h=s.outerHeight(),e.w=s.outerWidth()):n.fixed&&n.isBody?(e.h=l.innerHeight(),e.w=l.innerWidth()):(e.h=t[0].scrollHeight,e.w=t[0].scrollWidth),"relative"==t.css("position")&&t.css("position","relative"),n.lockX&&(e.mxR=e.mxL=e.left),n.lockY&&(e.mxT=e.mxB=e.top))},_getOffSize:function(){var t=this;t.offW=t.$parent.outerWidth(),t.offH=t.$parent.outerHeight(),t.left=parseInt(t.$parent.css("left")),t.top=parseInt(t.$parent.css("top")),t.mxR=Math.max(t.mxR,t.mxL+t.offW),t.mxB=Math.max(t.mxB,t.mxT+t.offH)},_move:function(t,e,n,i){var a,o,r,s=this;a=s.range(t,e,i,n),o=a.left,r=a.top,s.$parent.css({left:o,top:r}),s.left=o,s.top=r,s.options.onMove(r,o)},_end:function(){var t=this;s.unbind("mousemove",t._handleEvent),s.unbind("mouseup",t._handleEvent),o?(t.$parent.unbind("losecapture",t._end),t.$parent[0].releaseCapture()):s.unbind("blur",t._end),t.options.onEnd()},range:function(t,e,n,i){var a,o,r,s,l=this,c=l.options,d={};return c.limit&&(a=l.mxT,o=l.mxR,r=l.mxL,s=l.mxB,c.container&&(a=Math.max(l.mxT,0),o=Math.min(l.w-n,l.mxR),r=Math.max(l.mxL,0),s=Math.min(l.h-i,l.mxB)),e=Math.max(Math.min(e,o),r),t=Math.max(Math.min(t,s),a)),d.left=e,d.top=t,d},set:function(t){var e=this;t&&$.extend(e.options,t),e._size()},enable:function(){var t=this;t.$parent.bind("mousedown",t._handleEvent)},disable:function(){var t=this;t.$parent.unbind("mousedown",t._handleEvent)}},t}(),u={create:function(e){var n=new t(e);return a.push(n),n},load:function(t,e,n){return Dialog.create({type:"load",html:t,fixed:!0,unload:!0,shade:n||!1,delay:"undefined"!=typeof e?e:!1})},prompt:function(t,e,n,i){return Dialog.create({type:"prompt",html:t,value:e,fixed:!0,width:300,unload:!0,shade:!0,buttons:[{name:"确定",callback:n,disabled:!1,focus:!0},{name:"取消",callback:i,disabled:!1,focus:!1}]})},confirm:function(t,e,n){return Dialog.create({type:"confirm",html:t,fixed:!0,unload:!0,shade:!0,buttons:[{name:"确定",callback:e,disabled:!1,focus:!0},{name:"取消",callback:n,disabled:!1,focus:!1}]})},alert:function(t,e,n){return"function"==typeof e&&(n=e,e="信息"),Dialog.create({type:"alert",html:t,fixed:!0,title:e,unload:!0,shade:!0,buttons:[{name:"确定",callback:n,disabled:!1,focus:!0}]})},msg:function(t,e,n){return e="undefined"!=typeof e?e:!0,Dialog.create({type:"msg",title:!1,html:t,fixed:!0,unload:!0,shade:n||!1,closeBtn:e?!1:function(){},delay:e,isMove:!1})},config:function(t){return $.extend(c,t)}};"function"==typeof define?define(function(){return u}):window.Dialog=u}();